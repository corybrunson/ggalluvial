<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Check for alluvial structure and convert between alluvial formats — alluvial-data • ggalluvial</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Check for alluvial structure and convert between alluvial formats — alluvial-data"><meta name="description" content="Alluvial plots consist of multiple horizontally-distributed columns (axes)
representing factor variables, vertical divisions (strata) of these axes
representing these variables' values; and splines (alluvial flows) connecting
vertical subdivisions (lodes) within strata of adjacent axes representing
subsets or amounts of observations that take the corresponding values of the
corresponding variables. This function checks a data frame for either of two
types of alluvial structure:"><meta property="og:description" content="Alluvial plots consist of multiple horizontally-distributed columns (axes)
representing factor variables, vertical divisions (strata) of these axes
representing these variables' values; and splines (alluvial flows) connecting
vertical subdivisions (lodes) within strata of adjacent axes representing
subsets or amounts of observations that take the corresponding values of the
corresponding variables. This function checks a data frame for either of two
types of alluvial structure:"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggalluvial</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ggalluvial.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/labels.html">Labeling small strata</a></li>
    <li><a class="dropdown-item" href="../articles/order-rectangles.html">The Order of the Rectangles</a></li>
    <li><a class="dropdown-item" href="../articles/shiny.html">Tooltips for ggalluvial plots in Shiny apps</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/corybrunson/ggalluvial/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Check for alluvial structure and convert between alluvial formats</h1>
      <small class="dont-index">Source: <a href="https://github.com/corybrunson/ggalluvial/blob/HEAD/R/alluvial-data.r" class="external-link"><code>R/alluvial-data.r</code></a></small>
      <div class="d-none name"><code>alluvial-data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Alluvial plots consist of multiple horizontally-distributed columns (axes)
representing factor variables, vertical divisions (strata) of these axes
representing these variables' values; and splines (alluvial flows) connecting
vertical subdivisions (lodes) within strata of adjacent axes representing
subsets or amounts of observations that take the corresponding values of the
corresponding variables. This function checks a data frame for either of two
types of alluvial structure:</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">is_lodes_form</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">key</span>,</span>
<span>  <span class="va">value</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  site <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  logical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">is_alluvia_form</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  logical <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">to_lodes_form</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  key <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"stratum"</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"alluvium"</span>,</span>
<span>  diffuse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  discern <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">to_alluvia_form</span><span class="op">(</span><span class="va">data</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">id</span>, distill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame.</p></dd>


<dt id="arg-key-value-id">key, value, id<a class="anchor" aria-label="anchor" href="#arg-key-value-id"></a></dt>
<dd><p>In <code>to_lodes_form</code>, handled as in
<code><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">tidyr::gather()</a></code> and used to name the new axis (key), stratum
(value), and alluvium (identifying) variables. In <code>to_alluvia_form</code>,
handled as in <code><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">tidyr::spread()</a></code> and used to identify the fields
of <code>data</code> to be used as the axis (key), stratum (value), and alluvium
(identifying) variables.</p></dd>


<dt id="arg-weight">weight<a class="anchor" aria-label="anchor" href="#arg-weight"></a></dt>
<dd><p>Optional field of <code>data</code>, handled using
<code><a href="https://rlang.r-lib.org/reference/topic-defuse.html" class="external-link">rlang::enquo()</a></code>, to be used as heights or depths of
the alluvia or lodes.</p></dd>


<dt id="arg-site">site<a class="anchor" aria-label="anchor" href="#arg-site"></a></dt>
<dd><p>Optional vector of fields of <code>data</code>, handled using
<code><a href="https://rlang.r-lib.org/reference/topic-defuse.html" class="external-link">rlang::enquos()</a></code>, to be used to group rows before
testing for duplicate and missing id-axis pairings. Variables intended for
faceting should be passed to <code>site</code>.</p></dd>


<dt id="arg-logical">logical<a class="anchor" aria-label="anchor" href="#arg-logical"></a></dt>
<dd><p>Defunct. Whether to return a logical value or a character
string indicating the type of alluvial structure ("none", "lodes", or
"alluvia").</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Whether to print messages.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Used in <code>is_alluvia_form</code> and <code>to_lodes_form</code> as in
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code> to determine axis variables, as an alternative
to <code>axes</code>. Ignored when <code>axes</code> is provided.</p></dd>


<dt id="arg-axes">axes<a class="anchor" aria-label="anchor" href="#arg-axes"></a></dt>
<dd><p>In <code>*_alluvia_form</code>, handled as in
<code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">dplyr::select()</a></code> and used to identify the field(s) of
<code>data</code> to be used as axes.</p></dd>


<dt id="arg-diffuse">diffuse<a class="anchor" aria-label="anchor" href="#arg-diffuse"></a></dt>
<dd><p>Fields of <code>data</code>, handled using
<code><a href="https://tidyselect.r-lib.org/reference/vars_select.html" class="external-link">tidyselect::vars_select()</a></code>, to merge into the reshapen data by
<code>id</code>. They must be a subset of the axis variables. Alternatively, a
logical value indicating whether to merge all (<code>TRUE</code>) or none
(<code>FALSE</code>) of the axis variables.</p></dd>


<dt id="arg-discern">discern<a class="anchor" aria-label="anchor" href="#arg-discern"></a></dt>
<dd><p>Logical value indicating whether to suffix values of the
variables used as axes that appear at more than one variable in order to
distinguish their factor levels. This forces the levels of the combined
factor variable <code>value</code> to be in the order of the axes.</p></dd>


<dt id="arg-distill">distill<a class="anchor" aria-label="anchor" href="#arg-distill"></a></dt>
<dd><p>A logical value indicating whether to include variables, other
than those passed to <code>key</code> and <code>value</code>, that vary within values
of <code>id</code>. Alternatively, a function (or its name) to be used to distill
each such variable to a single value. In addition to existing functions,
<code>distill</code> accepts the character values <code>"first"</code> (used if
<code>distill</code> is <code>TRUE</code>), <code>"last"</code>, and <code>"most"</code> (which
returns the first modal value).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<ul><li><p>One row per <strong>lode</strong>, wherein each row encodes a subset or amount of
observations having a specific profile of axis values, a <code>key</code> field
encodes the axis, a <code>value</code> field encodes the value within each axis, and a
<code>id</code> column identifies multiple lodes corresponding to the same subset or
amount of observations. <code>is_lodes_form</code> tests for this structure.</p></li>
<li><p>One row per <strong>alluvium</strong>, wherein each row encodes a subset or amount of
observations having a specific profile of axis values and a set <code>axes</code> of
fields encodes its values at each axis variable. <code>is_alluvia_form</code> tests
for this structure.</p></li>
</ul><p><code>to_lodes_form</code> takes a data frame with several designated variables to
be used as axes in an alluvial plot, and reshapes the data frame so that
the axis variable names constitute a new factor variable and their values
comprise another. Other variables' values will be repeated, and a
row-grouping variable can be introduced. This function invokes
<code><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">tidyr::gather()</a></code>.</p>
<p><code>to_alluvia_form</code> takes a data frame with axis and axis value variables
to be used in an alluvial plot, and reshape the data frame so that the
axes constitute separate variables whose values are given by the value
variable. This function invokes <code><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">tidyr::spread()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other alluvial data manipulation:
<code><a href="self-adjoin.html">self-adjoin</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Titanic data in alluvia format</span></span></span>
<span class="r-in"><span><span class="va">titanic_alluvia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Titanic</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">titanic_alluvia</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Class    Sex   Age Survived Freq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1st   Male Child       No    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   2nd   Male Child       No    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   3rd   Male Child       No   35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  Crew   Male Child       No    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   1st Female Child       No    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   2nd Female Child       No    0</span>
<span class="r-in"><span><span class="fu">is_alluvia_form</span><span class="op">(</span><span class="va">titanic_alluvia</span>,</span></span>
<span class="r-in"><span>                weight <span class="op">=</span> <span class="st">"Freq"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># Titanic data in lodes format</span></span></span>
<span class="r-in"><span><span class="va">titanic_lodes</span> <span class="op">&lt;-</span> <span class="fu">to_lodes_form</span><span class="op">(</span><span class="va">titanic_alluvia</span>,</span></span>
<span class="r-in"><span>                               key <span class="op">=</span> <span class="st">"x"</span>, value <span class="op">=</span> <span class="st">"stratum"</span>, id <span class="op">=</span> <span class="st">"alluvium"</span>,</span></span>
<span class="r-in"><span>                               axes <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">titanic_lodes</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Freq alluvium     x stratum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0        1 Class     1st</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    0        2 Class     2nd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   35        3 Class     3rd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    0        4 Class    Crew</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    0        5 Class     1st</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    0        6 Class     2nd</span>
<span class="r-in"><span><span class="fu">is_lodes_form</span><span class="op">(</span><span class="va">titanic_lodes</span>,</span></span>
<span class="r-in"><span>              key <span class="op">=</span> <span class="st">"x"</span>, value <span class="op">=</span> <span class="st">"stratum"</span>, id <span class="op">=</span> <span class="st">"alluvium"</span>,</span></span>
<span class="r-in"><span>              weight <span class="op">=</span> <span class="st">"Freq"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># again in lodes format, this time diffusing the `Class` variable</span></span></span>
<span class="r-in"><span><span class="va">titanic_lodes2</span> <span class="op">&lt;-</span> <span class="fu">to_lodes_form</span><span class="op">(</span><span class="va">titanic_alluvia</span>,</span></span>
<span class="r-in"><span>                                key <span class="op">=</span> <span class="va">variable</span>, value <span class="op">=</span> <span class="va">value</span>,</span></span>
<span class="r-in"><span>                                id <span class="op">=</span> <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>                                <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, diffuse <span class="op">=</span> <span class="va">Class</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">titanic_lodes2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cohort Class Survived Freq variable value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1   1st       No    0    Class   1st</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      1   1st       No    0      Sex  Male</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      1   1st       No    0      Age Child</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      2   2nd       No    0    Class   2nd</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      2   2nd       No    0      Sex  Male</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      2   2nd       No    0      Age Child</span>
<span class="r-in"><span><span class="fu">is_lodes_form</span><span class="op">(</span><span class="va">titanic_lodes2</span>,</span></span>
<span class="r-in"><span>              key <span class="op">=</span> <span class="va">variable</span>, value <span class="op">=</span> <span class="va">value</span>, id <span class="op">=</span> <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>              weight <span class="op">=</span> <span class="va">Freq</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># use `site` to separate data before lode testing</span></span></span>
<span class="r-in"><span><span class="fu">is_lodes_form</span><span class="op">(</span><span class="va">titanic_lodes2</span>,</span></span>
<span class="r-in"><span>              key <span class="op">=</span> <span class="va">variable</span>, value <span class="op">=</span> <span class="va">value</span>, id <span class="op">=</span> <span class="va">Class</span>,</span></span>
<span class="r-in"><span>              weight <span class="op">=</span> <span class="va">Freq</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Duplicated id-axis pairings.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span><span class="fu">is_lodes_form</span><span class="op">(</span><span class="va">titanic_lodes2</span>,</span></span>
<span class="r-in"><span>              key <span class="op">=</span> <span class="va">variable</span>, value <span class="op">=</span> <span class="va">value</span>, id <span class="op">=</span> <span class="va">Class</span>,</span></span>
<span class="r-in"><span>              weight <span class="op">=</span> <span class="va">Freq</span>, site <span class="op">=</span> <span class="va">cohort</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># curriculum data in lodes format</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">majors</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">majors</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   student semester curriculum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1    CURR1   Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       2    CURR1   Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       6    CURR1   Sculpure</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       8    CURR1   Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       9    CURR1   Sculpure</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      10    CURR1   Painting</span>
<span class="r-in"><span><span class="fu">is_lodes_form</span><span class="op">(</span><span class="va">majors</span>,</span></span>
<span class="r-in"><span>              key <span class="op">=</span> <span class="st">"semester"</span>, value <span class="op">=</span> <span class="st">"curriculum"</span>, id <span class="op">=</span> <span class="st">"student"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># curriculum data in alluvia format</span></span></span>
<span class="r-in"><span><span class="va">majors_alluvia</span> <span class="op">&lt;-</span> <span class="fu">to_alluvia_form</span><span class="op">(</span><span class="va">majors</span>,</span></span>
<span class="r-in"><span>                                  key <span class="op">=</span> <span class="st">"semester"</span>, value <span class="op">=</span> <span class="st">"curriculum"</span>,</span></span>
<span class="r-in"><span>                                  id <span class="op">=</span> <span class="st">"student"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">majors_alluvia</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   student    CURR1       CURR3       CURR5    CURR7    CURR9   CURR11   CURR13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1 Painting    Painting    Painting Painting Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       2 Painting    Painting    Painting Painting Painting Painting     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       6 Sculpure    Sculpure    Painting Painting Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       8 Painting    Painting    Painting Painting     &lt;NA&gt; Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       9 Sculpure Art History Art History Painting Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      10 Painting    Painting    Painting Painting Painting Painting     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     CURR15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     &lt;NA&gt;</span>
<span class="r-in"><span><span class="fu">is_alluvia_form</span><span class="op">(</span><span class="va">majors_alluvia</span>, <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"CURR"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Missing alluvia for some stratum combinations.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># distill variables that vary within `id` values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">majors</span><span class="op">$</span><span class="va">hypo_grade</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">5</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">majors</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">majors_alluvia2</span> <span class="op">&lt;-</span> <span class="fu">to_alluvia_form</span><span class="op">(</span><span class="va">majors</span>,</span></span>
<span class="r-in"><span>                                   key <span class="op">=</span> <span class="st">"semester"</span>, value <span class="op">=</span> <span class="st">"curriculum"</span>,</span></span>
<span class="r-in"><span>                                   id <span class="op">=</span> <span class="st">"student"</span>,</span></span>
<span class="r-in"><span>                                   distill <span class="op">=</span> <span class="st">"most"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distilled variables: hypo_grade</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">majors_alluvia2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   student hypo_grade    CURR1       CURR3       CURR5    CURR7    CURR9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       1          A Painting    Painting    Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       2          D Painting    Painting    Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       6          B Sculpure    Sculpure    Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       8          B Painting    Painting    Painting Painting     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       9          E Sculpure Art History Art History Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      10          A Painting    Painting    Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     CURR11   CURR13   CURR15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Painting     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Painting Painting Painting</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Painting     &lt;NA&gt;     &lt;NA&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># options to distinguish strata at different axes</span></span></span>
<span class="r-in"><span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">majors_alluvia</span>,</span></span>
<span class="r-in"><span>             <span class="fu">aes</span><span class="op">(</span>axis1 <span class="op">=</span> <span class="va">CURR1</span>, axis2 <span class="op">=</span> <span class="va">CURR7</span>, axis3 <span class="op">=</span> <span class="va">CURR13</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gg</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_alluvium.html">geom_alluvium</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">student</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_stratum.html">geom_stratum</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_text</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, discern <span class="op">=</span> <span class="cn">TRUE</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="alluvial-data-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">gg</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_alluvium.html">geom_alluvium</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">student</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_stratum.html">geom_stratum</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_text</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, discern <span class="op">=</span> <span class="cn">FALSE</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">stratum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="alluvial-data-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># warning when inappropriate</span></span></span>
<span class="r-in"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">majors</span><span class="op">[</span><span class="va">majors</span><span class="op">$</span><span class="va">semester</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CURR"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">semester</span>, stratum <span class="op">=</span> <span class="va">curriculum</span>, alluvium <span class="op">=</span> <span class="va">student</span>,</span></span>
<span class="r-in"><span>           label <span class="op">=</span> <span class="va">curriculum</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_alluvium.html">geom_alluvium</a></span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">student</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_stratum.html">geom_stratum</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span>, discern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu">geom_text</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, discern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Data is already in lodes format, so `discern` will be ignored.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Data is already in lodes format, so `discern` will be ignored.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Data is already in lodes format, so `discern` will be ignored.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 1 row containing missing values or values outside the scale range</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> (`geom_text()`).</span>
<span class="r-plt img"><img src="alluvial-data-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Cory Brunson, Quentin D. Read.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

